# Workstream Schemas & Templates

Reference schemas for workstream output artifacts.

---

## status.json Format

Written to `.claude/status.json`:

```json
{
  "version": "1.0",
  "created": "<ISO timestamp>",
  "project": "<project key>",
  "workstreams": {
    "WS-1": {
      "name": "Authentication",
      "tickets": ["PROJ-101", "PROJ-102", "PROJ-103"]
    }
  },
  "tickets": {
    "PROJ-101": {
      "summary": "User login",
      "area": "auth",
      "workstream": "WS-1",
      "phase": 1,
      "depth": 0,
      "status": "ready",
      "blocked_by": [],
      "blocks": ["PROJ-201", "PROJ-401"],
      "depends_on": [],
      "plan_status": "none",
      "build_status": "none",
      "pr_number": null,
      "pr_status": null,
      "retry_count": 0
    }
  },
  "phases": {
    "1": ["PROJ-101", "PROJ-901"],
    "2": ["PROJ-201", "PROJ-401", "PROJ-801"]
  },
  "critical_path": ["PROJ-101", "PROJ-201", "PROJ-301"],
  "dependency_graph": {
    "PROJ-101": [],
    "PROJ-201": ["PROJ-101"],
    "PROJ-301": ["PROJ-201"]
  }
}
```

---

## WORKSTREAMS.md Format

Written to `.claude/WORKSTREAMS.md`:

```markdown
# Workstreams

Generated: <timestamp>
Total tickets: <count>
Total phases: <count>
Critical path: <ticket chain>

## Phase 1 — Foundation

| Ticket | Summary | Workstream | Status | Blocked By |
|--------|---------|------------|--------|------------|
| PROJ-101 | User login | WS-1: Auth | ready | -- |
| PROJ-901 | CI pipeline | WS-5: Infra | ready | -- |

## Phase 2 — Core Features

| Ticket | Summary | Workstream | Status | Blocked By |
|--------|---------|------------|--------|------------|
| PROJ-201 | CSV import | WS-2: Import | ready | PROJ-101 |
| PROJ-401 | Create asset | WS-3: Domain | ready | PROJ-101 |

## Workstream Summary

| ID | Name | Tickets | Phase Span |
|----|------|---------|------------|
| WS-1 | Authentication | 3 | 1-2 |
| WS-2 | Data Import | 3 | 2-3 |
| WS-3 | Core Domain | 5 | 2-4 |
```

---

## Ticket Template

Tickets generated by Stage 2 (or expected by Stage 3 for the default entry point) follow this structure:

```markdown
---
id: PROJ-101
summary: User login with email and password
area: auth
priority: critical
status: ready
blocked_by: []
blocks:
  - PROJ-201
  - PROJ-401
  - PROJ-801
depends_on: []
acceptance_criteria:
  - User can log in with valid email and password
  - Invalid credentials return 401 with error message
  - Successful login returns access token and refresh token
  - Tokens have appropriate expiry times
---

# PROJ-101: User Login

## Description

Implement email/password authentication using Auth0. The login endpoint
accepts credentials, validates them against Auth0, and returns JWT tokens.

## Technical Notes

- Auth0 tenant configuration required (see PROJ-800)
- Token format: JWT with RS256 signing
- Access token TTL: 15 minutes
- Refresh token TTL: 7 days

## Acceptance Criteria

- [ ] User can log in with valid email and password
- [ ] Invalid credentials return 401 with error message
- [ ] Successful login returns access token and refresh token
- [ ] Tokens have appropriate expiry times

## API Contract

POST /api/auth/login
Request: { email: string, password: string }
Response 200: { access_token: string, refresh_token: string }
Response 401: { error: string, message: string }
```

---

## Ticket Enrichment

Each ticket file in `.claude/tickets/` is updated with computed fields after dependency analysis:

```yaml
---
# ... existing frontmatter ...
workstream: WS-1
phase: 1
depth: 0
# ... rest of frontmatter ...
---
```
